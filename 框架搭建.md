# 框架搭建

## 1、服务器IP

```shell

# 虚拟机的系统为Red Hat
cat /etc/redhat-release
Red Hat Enterprise Linux Server release 7.9 (Maipo)
```

## 2、账号密码

账号：（具有sudo权限）

```shell
xtgl_test
```

密码：

```shell
123456
```

## 3、将需要的文件放入服务器

文件下载

## 4、安装软件

### 4.1、安装jdk8

```shell
cd /home/xtgl_test/jdk8
tar -zxvf jdk-8u381-linux-x64.tar.gz
```

#### 4.1.1、配置环境变量

使用命令修改 /etc/profile 文件

```shell
sudo vim /etc/profile
#可能会需要输入密码
#按 i 进行输入操作，在最后一行添加
#set java environment
export JAVA_HOME=/home/xtgl_test/jdk8/jdk1.8.0_381
export JRE_HOME=$JAVA_HOME/jre
export CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/
export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin
export JAVA_HOME JRE_HOME CLASS_PATH PATH
```

添加完成后，按 esc ,然后按 shift+:，输入wq, 按 enter 键 保存数据。为了使 /etc/profile 文件修改生效，需要使用如下命令：

```shell
reource /etc/profile
```

修改完成后使用命令查询是否配置生效：

```shell
[xtgl_test@localhost jdk8]$ java -version
java version "1.8.0_381"
Java(TM) SE Runtime Environment (build 1.8.0_381-b09)
Java HotSpot(TM) 64-Bit Server VM (build 25.381-b09, mixed mode)
```

### 4.2、安装zookeeper

当前 zookeeper 的版本为 3.4.10，进行解压缩

```shell
cd /home/xtgl_test/zookeeper/
tar -zxvf zookeeper-3.4.10.tar.gz

#解压后进入 zookeeper-3.4.10，新建 data 和 logs 文件夹
[xtgl_test@localhost zookeeper-3.4.10]$ cd zookeeper-3.4.10
[xtgl_test@localhost zookeeper-3.4.10]$ mkdir data
 [xtgl_test@localhost zookeeper-3.4.10]$ mkdir logs
[xtgl_test@localhost zookeeper-3.4.10]$ ll
total 1564
drwxr-xr-x  2 xtgl_test xtgl_test     170 Apr  9 15:25 bin
-rw-rw-r--  1 xtgl_test xtgl_test   84725 Mar 23  2017 build.xml
drwxr-xr-x  2 xtgl_test xtgl_test      92 Apr  9 16:08 conf
drwxr-xr-x 10 xtgl_test xtgl_test     130 Mar 23  2017 contrib
drwxrwxr-x  3 xtgl_test xtgl_test      51 Apr  9 15:30 data
drwxr-xr-x  2 xtgl_test xtgl_test    4096 Mar 23  2017 dist-maven
drwxr-xr-x  6 xtgl_test xtgl_test    4096 Mar 23  2017 docs
-rw-rw-r--  1 xtgl_test xtgl_test    1709 Mar 23  2017 ivysettings.xml
-rw-rw-r--  1 xtgl_test xtgl_test    5691 Mar 23  2017 ivy.xml
drwxr-xr-x  4 xtgl_test xtgl_test     267 Mar 23  2017 lib
-rw-rw-r--  1 xtgl_test xtgl_test   11938 Mar 23  2017 LICENSE.txt
drwxrwxr-x  2 xtgl_test xtgl_test       6 Apr  9 15:28 logs
-rw-rw-r--  1 xtgl_test xtgl_test    3132 Mar 23  2017 NOTICE.txt
-rw-rw-r--  1 xtgl_test xtgl_test    1770 Mar 23  2017 README_packaging.txt
-rw-rw-r--  1 xtgl_test xtgl_test    1585 Mar 23  2017 README.txt
drwxr-xr-x  5 xtgl_test xtgl_test      47 Mar 23  2017 recipes
drwxr-xr-x  8 xtgl_test xtgl_test     211 Mar 23  2017 src
-rw-rw-r--  1 xtgl_test xtgl_test 1456729 Mar 23  2017 zookeeper-3.4.10.jar
-rw-rw-r--  1 xtgl_test xtgl_test     819 Mar 23  2017 zookeeper-3.4.10.jar.asc
-rw-rw-r--  1 xtgl_test xtgl_test      33 Mar 23  2017 zookeeper-3.4.10.jar.md5
-rw-rw-r--  1 xtgl_test xtgl_test      41 Mar 23  2017 zookeeper-3.4.10.jar.sha1

```

进入 zookeeper 的配置文件目录

```shell
cd zookeeper-3.4.10/conf
#使用 ll 显示所有文件
[xtgl_test@localhost conf]$ ll
total 16
-rw-rw-r-- 1 xtgl_test xtgl_test  535 Mar 23  2017 configuration.xsl
-rw-rw-r-- 1 xtgl_test xtgl_test 2161 Mar 23  2017 log4j.properties
-rw-rw-r-- 1 xtgl_test xtgl_test  922 Mar 23  2017 zoo_sample.cfg
```

zookeeper 启动，会默认加载 conf 目录下的配置 zoo.cfg。使用命令复制一份

```shell
[xtgl_test@localhost conf]$ cp zoo_sample.cfg zoo.cfg
[xtgl_test@localhost conf]$ ll
total 16
-rw-rw-r-- 1 xtgl_test xtgl_test  535 Mar 23  2017 configuration.xsl
-rw-rw-r-- 1 xtgl_test xtgl_test 2161 Mar 23  2017 log4j.properties
-rw-rw-r-- 1 xtgl_test xtgl_test 1009 Apr  9 15:29 zoo.cfg
-rw-rw-r-- 1 xtgl_test xtgl_test  922 Mar 23  2017 zoo_sample.cfg
```

修改 zoo.cfg文件，设置 dataDir 和 logDir

```shell
# The number of milliseconds of each tick
tickTime=2000
# The number of ticks that the initial
# synchronization phase can take
initLimit=10
# The number of ticks that can pass between
# sending a request and getting an acknowledgement
syncLimit=5
# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just
# example sakes.
dataDir=/home/xtgl_test/zookeeper/zookeeper-3.4.10/data
logDir=/home/xtgl_test/zookeeper/zookeeper-3.4.10/logs
# the port at which the clients will connect
clientPort=2181
# the maximum number of client connections.
# increase this if you need to handle more clients
#maxClientCnxns=60
#
# Be sure to read the maintenance section of the
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance
#
# The number of snapshots to retain in dataDir
#autopurge.snapRetainCount=3
# Purge task interval in hours
# Set to "0" to disable auto purge featurejinru
#autopurge.purgeInterval=1
```

进入 bin 目录，启动 zookeeper

```shell
[xtgl_test@localhost ~]$ cd /home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/
[xtgl_test@localhost bin]$ ll
total 44
-rwxr-xr-x 1 xtgl_test xtgl_test  232 Mar 23  2017 README.txt
-rwxr-xr-x 1 xtgl_test xtgl_test 1937 Mar 23  2017 zkCleanup.sh
-rwxr-xr-x 1 xtgl_test xtgl_test 1056 Mar 23  2017 zkCli.cmd
-rwxr-xr-x 1 xtgl_test xtgl_test 1534 Mar 23  2017 zkCli.sh
-rwxr-xr-x 1 xtgl_test xtgl_test 1628 Mar 23  2017 zkEnv.cmd
-rwxr-xr-x 1 xtgl_test xtgl_test 2696 Mar 23  2017 zkEnv.sh
-rwxr-xr-x 1 xtgl_test xtgl_test 1089 Mar 23  2017 zkServer.cmd
-rwxr-xr-x 1 xtgl_test xtgl_test 6773 Mar 23  2017 zkServer.sh
-rw-rw-r-- 1 xtgl_test xtgl_test 5395 Apr  9 16:03 zookeeper.out

```

使用如下命令启动 zookeeper

```shell
[xtgl_test@localhost bin]$ ./zkServer.sh start
ZooKeeper JMX enabled by default
Using config: /home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../conf/zoo.cfg
Starting zookeeper ... STARTEDshell
```

进入 zookeeper 客户端

```shell
[xtgl_test@localhost bin]$ ./zkCli.sh
Connecting to localhost:2181
2024-04-09 16:19:45,603 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.10-39d3a4f269333c922ed3db283be479f9deacaa0f, built on 03/23/2017 10:13 GMT
2024-04-09 16:19:45,605 [myid:] - INFO  [main:Environment@100] - Client environment:host.name=localhost
2024-04-09 16:19:45,605 [myid:] - INFO  [main:Environment@100] - Client environment:java.version=1.8.0_381
2024-04-09 16:19:45,606 [myid:] - INFO  [main:Environment@100] - Client environment:java.vendor=Oracle Corporation
2024-04-09 16:19:45,606 [myid:] - INFO  [main:Environment@100] - Client environment:java.home=/home/xtgl_test/jdk8/jdk1.8.0_381/jre
2024-04-09 16:19:45,606 [myid:] - INFO  [main:Environment@100] - Client environment:java.class.path=/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../build/classes:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../build/lib/*.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../lib/slf4j-log4j12-1.6.1.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../lib/slf4j-api-1.6.1.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../lib/netty-3.10.5.Final.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../lib/log4j-1.2.16.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../lib/jline-0.9.94.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../zookeeper-3.4.10.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../src/java/lib/*.jar:/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin/../conf:.:/usr/local/jdk1.8/lib/dt.jar:/usr/local/jdk1.8/lib/tool.jar
2024-04-09 16:19:45,606 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
2024-04-09 16:19:45,606 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=<NA>
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=amd64
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=3.10.0-1160.el7.x86_64
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=xtgl_test
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/home/xtgl_test
2024-04-09 16:19:45,607 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/home/xtgl_test/zookeeper/zookeeper-3.4.10/bin
2024-04-09 16:19:45,608 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@68de145
Welcome to ZooKeeper!
2024-04-09 16:19:45,622 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1032] - Opening socket connection to server localhost/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)
JLine support is enabled
2024-04-09 16:19:45,626 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@876] - Socket connection established to localhost/127.0.0.1:2181, initiating session
2024-04-09 16:19:45,631 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1299] - Session establishment complete on server localhost/127.0.0.1:2181, sessionid = 0x18ec1f03cb10001, negotiated timeout = 30000

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
[zk: localhost:2181(CONNECTED) 0]
```

使用  ls [节点路径]查看各个节点数据

```shell
[zk: localhost:2181(CONNECTED) 3] ls /
[zookeeper]
[zk: localhost:2181(CONNECTED) 4] ls /zookeeper
[quota]
[zk: localhost:2181(CONNECTED) 5] ls /zookeeper/quota
[]
[zk: localhost:2181(CONNECTED) 6]
```

使用 quit 命令退出客户端。

此处推荐一个 zookeeper 可视化工具。prettyZoo，使用方便，查询便捷，下载地址：文件下载

### 4.3、安装 MySQL5.7

#### 4.3.1、在 /usr/local目录下新建 mysql 文件夹（文件夹名命名为 mysql）。

```shell
[xtgl_test@localhost /]$ sudo mkdir /usr/local/mysql
[xtgl_test@localhost /]$ cd /usr/local/mysql
```

#### 4.3.2、将 文件放入新建的目录中，执行解压命令

```shell
[xtgl_test@localhost mysql]$ sudo tar -zxvf mysql-5.7.44-linux-glibc2.12-x86_64.tar.gz
...
...
[xtgl_test@localhost mysql]$ ll
total 678504
drwxr-xr-x 9 root      root            129 Apr 14 14:20 mysql-5.7.44-linux-glibc2.12-x86_64
-rw-rw-r-- 1 xtgl_test xtgl_test 694785800 Apr  9 17:14 mysql-5.7.44-linux-glibc2.12-x86_64.tar.gz
```

#### 4.3.3、将 mysql-5.7.44-linux-glibc2.12-x86_64 中的所有文件移动到 /usr/local/mysql目录下,并删除当前文件夹

```shell
[xtgl_test@localhost mysql]$ cd mysql-5.7.44-linux-glibc2.12-x86_64
[xtgl_test@localhost mysql-5.7.44-linux-glibc2.12-x86_64]$ sudo mv * ../
[xtgl_test@localhost mysql]$ sudo rm -rf mysql-5.7.44-linux-glibc2.12-x86_64
```

#### 4.3.4、在 /usr/local/mysql 下新建 data 目录

```shell
[xtgl_test@localhost mysql]$ sudo mkdir data
```

#### 4.3.5、进入 mysql 的 bin 目录，执行初始化命令

```shell
[xtgl_test@localhost mysql]$ cd bin/
[xtgl_test@localhost bin]$ sudo ./mysqld --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --initialize
2024-04-14T06:29:53.355696Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).
2024-04-14T06:29:54.423304Z 0 [Warning] InnoDB: New log files created, LSN=45790
2024-04-14T06:29:54.560808Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2024-04-14T06:29:54.625440Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 680b0bb2-fa28-11ee-8677-52540093bba5.
2024-04-14T06:29:54.626811Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2024-04-14T06:29:55.462715Z 0 [Warning] A deprecated TLS version TLSv1 is enabled. Please use TLSv1.2 or higher.
2024-04-14T06:29:55.462735Z 0 [Warning] A deprecated TLS version TLSv1.1 is enabled. Please use TLSv1.2 or higher.
2024-04-14T06:29:55.465129Z 0 [Warning] CA certificate ca.pem is self signed.
2024-04-14T06:29:55.590207Z 1 [Note] A temporary password is generated for root@localhost: .g+Wqo.!D6q(
[xtgl_test@localhost bin]$ 
```

**注意：安装 mysql前，需要将之前安装的 mysql 删除，并且删除 /etc/my.cnf等文件。正常安装完成后，如上显示，.g+Wqo.!D6q( 为安装密码。后续登陆需要使用，请提前保存。**

#### 4.3.6、拷贝可执行配置文件

```shell
[xtgl_test@localhost bin]$ cd /usr/local/mysql/
[xtgl_test@localhost mysql]$ sudo cp support-files/mysql.server /etc/init.d/mysqld
```

#### 4.3.7、配置 /etc/my.cnf 文件

使用 如下命令进入 编辑页面，按 i 进入编辑功能，编辑完成后使用 wq 进行保存即可

```shell
[xtgl_test@localhost etc]$ sudo vim /etc/my.cnf
```

my.cnf 配置文件的内容如下

```shell
[mysqld]
port = 3306
basedir = /usr/local/mysql
datadir=/usr/local/mysql/data
socket=/tmp/mysql.sock
pid-file=/usr/local/mysql/data/mysql.pid
log-error=/usr/local/mysql/data/error.log
character_set_server=utf8
user=mysql
max_connections=1500
symbolic-links=0
# 东八区时区，北京时区
default-time-zone = '+8:00'
sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
# 导入包允许的大小设置
max_allowed_packet=1024M
# 忽略表名大小写;1表示忽略大小写,0表示解析大小写
lower_case_table_names=1
#!includedir /etc/my.cnf.d
```

#### 4.3.8、启动服务并登陆

```shell
[xtgl_test@localhost /]$ sudo service mysqld start
Starting MySQL.Logging to '/usr/local/mysql/data/error.log'.
 SUCCESS! 
[xtgl_test@localhost /]$ mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.7.44

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> 
```

**注意：当 出现 bash:mysql：command not found 错误时，表示当前命令没有在 /usr/bin 下创建链接，重新创建链接即可，执行下面的命令然后重新登陆即可。**

```shell
ln -s /usr/local/mysql/bin/mysql /usr/bin
```

#### 4.3.9、修改密码并运行远程连接

```mysql
mysql-> set password=password('123456');
mysql-> use mysql;
mysql-> update user set host='%' where user='root';
mysql-> flush privileges;
```

**注意：如果可视化工具无法连接 MySQL，请先查下防火墙是否开启，对应的映射端口是否打开**



### 4.4、安装 Nacos

#### 4.4.1、版本说明

| 组件         | 版本      | 备注          |
| ------------ | --------- | ------------- |
| nacos-server | 2.2.3     |               |
| mysql        | 5.7.44    | 安装步骤见4.3 |
| jdk8         | 1.8.0_381 | 安装步骤见4.1 |

#### 4.4.2、进入文件目录后解压文件

```shell
cd  /home/xtgl_test/nacos
sudo tar -zxvf nacos-server-2.2.3.tar.gz
```

#### 4.4.3、配置

单机配置：

进入 conf 目录，将 mysql-schema.sql 文件中的表数据添加到 mysql 中。（使用可视化工具即可）

```
[xtgl_test@localhost nacos]$ cd conf/
[xtgl_test@localhost conf]$ ll
total 92
-rw-r--r-- 1 502 games  1224 Mar 13  2023 1.4.0-ipv6_support-update.sql
-rw-r--r-- 1 502 games   127 May 24  2023 announcement.conf
-rw-r--r-- 1 502 games 10834 May 25  2023 application.properties
-rw-r--r-- 1 502 games  9435 May 24  2023 application.properties.example
-rw-r--r-- 1 502 games   670 May 24  2023 cluster.conf.example
-rw-r--r-- 1 502 games  8939 May 24  2023 derby-schema.sql
-rw-r--r-- 1 502 games 10825 May 25  2023 mysql-schema.sql
-rw-r--r-- 1 502 games 31156 May 25  2023 nacos-logback.xml
```

修改 application.properties 中的一些配置信息

```properties
### Connect URL of DB:
# db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC
# db.user.0=nacos
# db.password.0=nacos

# 配置数据库信息
### Connect URL of DB:
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=UTC
db.user.0=nacos
db.password.0=nacos
```

进入 bin 目录，

```shell
[xtgl_test@localhost mysql]$ cd /home/xtgl_test/nacos/nacos/bin/
[xtgl_test@localhost bin]$ ll
total 20
-rwxr-xr-x 1 502 games  954 May 14  2020 shutdown.cmd
-rwxr-xr-x 1 502 games  951 Mar  6  2023 shutdown.sh
-rwxr-xr-x 1 502 games 3387 May 24  2023 startup.cmd
-rwxr-xr-x 1 502 games 5154 May 25  2023 startup.sh
# -m standalone 以单机模式启动（默认是集群模式）
[xtgl_test@localhost bin]$ sudo ./startup.sh -m standalone
```

当启动后遇到如下问题：

```shell
[xtgl_test@localhost bin]$ sudo ./startup.sh -m standalone
[sudo] password for xtgl_test: 
which: no javac in (/sbin:/bin:/usr/sbin:/usr/bin)
readlink: missing operand
Try 'readlink --help' for more information.
dirname: missing operand
Try 'dirname --help' for more information.
ERROR: Please set the JAVA_HOME variable in your environment, We need java(x64)! jdk8 or later is better! !!
```

解决思路：

​	nacos 的 startup.sh 脚本内寻找 java 环境路径金额我们安装的 java 环境路径不同，在 startup.sh 新增 JAVA_HOME 即可。

```shell
[ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=$HOME/jdk/java
[ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=/usr/java
[ ! -e "$JAVA_HOME/bin/java" ] && JAVA_HOME=/opt/taobao/java
[ ! -e "$JAVA_HOME/bin/java" ] && unset JAVA_HOME
# 在这加入我们配置的 jdk 路径
JAVA_HOME=/home/xtgl_test/jdk8/jdk1.8.0_381
```

重新启动 nacos，启动成功。

```shell
[xtgl_test@localhost bin]$ sudo ./startup.sh -m standalone
/home/xtgl_test/jdk8/jdk1.8.0_381/bin/java -Djava.ext.dirs=/home/xtgl_test/jdk8/jdk1.8.0_381/jre/lib/ext:/home/xtgl_test/jdk8/jdk1.8.0_381/lib/ext  -Xms512m -Xmx512m -Xmn256m -Dnacos.standalone=true -Dnacos.member.list= -Xloggc:/home/xtgl_test/nacos/nacos/logs/nacos_gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=10 -XX:GCLogFileSize=100M -Dloader.path=/home/xtgl_test/nacos/nacos/plugins,/home/xtgl_test/nacos/nacos/plugins/health,/home/xtgl_test/nacos/nacos/plugins/cmdb,/home/xtgl_test/nacos/nacos/plugins/selector -Dnacos.home=/home/xtgl_test/nacos/nacos -jar /home/xtgl_test/nacos/nacos/target/nacos-server.jar  --spring.config.additional-location=file:/home/xtgl_test/nacos/nacos/conf/ --logging.config=/home/xtgl_test/nacos/nacos/conf/nacos-logback.xml --server.max-http-header-size=524288
nacos is starting with standalone
nacos is starting，you can check the /home/xtgl_test/nacos/nacos/logs/start.out
```

在浏览器中输入 http://127.0.0.1:8848/nacos，进入nacos 网页。账号密码均为 nacos.

### 4.5、安装 kafka

#### 4.5.1、进入 文件所有路径，然后解压文件

```shell
[xtgl_test@localhost mysql]$ cd /home/xtgl_test/kafka/
[xtgl_test@localhost mysql]$ sudo tar -zxvf kafka_2.11-1.0.0.tgz
```

#### 4.5.2 修改配置

进入 config 目录，修改 server.properties 文件。

```properties
# 修改 zookeeper 的连接地址
zookeeper.connect=127.0.0.1:2181
```

进入根目录，执行启动命令

```shell
[xtgl_test@localhost kafka_2.11-1.0.0]$ bin/kafka-server-start.sh config/server.properties &
```

```shell
# 进入 zookeeper 客户端查看，brokers 节点已经写入到 zookeeper中
[zk: localhost:2181(CONNECTED) 0] ls /
[cluster, controller, controller_epoch, brokers, zookeeper, admin, isr_change_notification, consumers, log_dir_event_notification, latest_producer_id_block, config]
```

### 4.6、安装 redis

#### 4.6.1、下载并解压文件

本文档使用的 reids 版本为  5.0.9

下载地址

```shell
[xtgl_test@localhost /]$ cd /home/xtgl_test/redis/
[xtgl_test@localhost redis]$ sudo zxcv redis-5.0.9.tar.gz 
```

#### 4.6.2 、编译安装到指定目录

```shell
[xtgl_test@localhost redis-5.0.9]$ cd redis-5.0.9/
[xtgl_test@localhost redis-5.0.9]$ sudo mkdir log
[xtgl_test@localhost redis-5.0.9]$ sudo mkdir data
# 编译
[xtgl_test@localhost redis-5.0.9]$ sudo make
# 安装到指定目录
[xtgl_test@localhost redis-5.0.9]$ sudo make install PREFIX = /usr/local/redis
# 将配置文件复制到指定目录
[xtgl_test@localhost redis-5.0.9]$ sudo cp //home/xtgl_test/redis/redis-5.0.9/redis.conf /usr/local/redis
```

#### 4.6.3、修改配置文件

| 修改内容                                                  | 注释                                                         |
| --------------------------------------------------------- | ------------------------------------------------------------ |
| bind 127.0.0.1                                            | 这行需要注释掉，接触本地连接设置                             |
| protected-mode no                                         | 默认 yes ，如果设置为 yes, 则允许在本机连接，其他机器无法连接 |
| requirepass 123456                                        | 设置密码                                                     |
| appendonly yes                                            | 原来为 no, 改为 yes 开启持久化                               |
| logfile "/home/xtgl_test/redis/redis-5.0.9/log/redis.log" | 配置日志保存记录                                             |
| dir /home/xtgl_test/redis/redis-5.0.9/data                | 数据保存目录                                                 |
| maxmemory 128M                                            | 使用的最大內存值                                             |
| daemonize yes                                             | yes代表允许后台允许                                          |

#### 4.6.4、启动redis

```shell
[xtgl_test@localhost bin]$ sudo ./redis-server ../redis.conf 
```

**注意：如果启动不生效，可能是文件没有导入成功，请注意文件夹的权限问题，配置文件导入成功后，最后使用 vim 命令浏览一下，查看是否导入成功**

在另一个连接页面使用命令启动客户端，执行如下命令

```shell
[xtgl_test@localhost bin]$ ll
total 32772
-rwxr-xr-x 1 root root 4367120 Apr 17 10:15 redis-benchmark
-rwxr-xr-x 1 root root 8125424 Apr 17 10:15 redis-check-aof
-rwxr-xr-x 1 root root 8125424 Apr 17 10:15 redis-check-rdb
-rwxr-xr-x 1 root root 4808120 Apr 17 10:15 redis-cli
lrwxrwxrwx 1 root root      12 Apr 17 10:15 redis-sentinel -> redis-server
-rwxr-xr-x 1 root root 8125424 Apr 17 10:15 redis-server
[xtgl_test@localhost bin]$ ./redis-cli 
127.0.0.1:6379> ping
(error) NOAUTH Authentication required.
127.0.0.1:6379> auth 123456
OK
127.0.0.1:6379> ping
PONG
127.0.0.1:6379> 
```

#### 4.6.5、设置快捷启动

将 redis 添加到守护进程并设置开机自启

创建 redis.service 文件

```shell
[xtgl_test@localhost bin]$ cd /etc/systemd/system
[xtgl_test@localhost system]$ sudo touch redis.service
[sudo] password for xtgl_test: 
[xtgl_test@localhost system]$ ll
total 4
drwxr-xr-x. 2 root root   57 Sep  2  2022 basic.target.wants
lrwxrwxrwx. 1 root root   57 Sep  2  2022 dbus-org.freedesktop.nm-dispatcher.service -> /usr/lib/systemd/system/NetworkManager-dispatcher.service
lrwxrwxrwx. 1 root root   37 Sep  2  2022 default.target -> /lib/systemd/system/multi-user.target
drwxr-xr-x. 2 root root   87 Sep  2  2022 default.target.wants
drwxr-xr-x. 2 root root   38 Sep  2  2022 dev-virtio\x2dports-org.qemu.guest_agent.0.device.wants
drwxr-xr-x. 2 root root   32 Sep  2  2022 getty.target.wants
drwxr-xr-x. 2 root root   35 Sep  2  2022 local-fs.target.wants
drwxr-xr-x. 2 root root 4096 Apr 14 16:15 multi-user.target.wants
drwxr-xr-x. 2 root root   48 Sep  2  2022 network-online.target.wants
-rw-r--r--  1 root root    0 Apr 17 16:20 redis.service
drwxr-xr-x. 2 root root   29 Sep  2  2022 sockets.target.wants
drwxr-xr-x. 2 root root  254 Sep  2  2022 sysinit.target.wants
drwxr-xr-x. 2 root root   44 Sep  2  2022 system-update.target.wants
[xtgl_test@localhost system]$ sudo chmod 777 redis.service 
[xtgl_test@localhost system]$ 
```

添加以下内容

```shell
[Unit]
Desrciption=Redis
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/redis.conf
ExecStop=/usr/local/redis/bin/redis-server -s stop
PrivateTmp=true
User=root
Group=root

[Install]
WantedBy=multi-user.target
```

常用命令如下：

```shell
# 启动 redis
[xtgl_test@localhost system]$ sudo systemctl stop redis.service
# 关闭 redis
[xtgl_test@localhost system]$ sudo systemctl start redis.service
# 设置开机自启
[xtgl_test@localhost system]$ sudo systemctl enable redis.service
# 关闭开机自启
[xtgl_test@localhost system]$ sudo systemctl disable redis.service
# 查看运行状态
[xtgl_test@localhost system]$ sudo systemctl status redis.service 
```





























